<?php
/**
 * Created by PhpStorm.
 * User: naomileow
 * Date: 19/11/14
 * Time: 2:05 AM
 */

namespace Phortress\Dephenses\Engine;


use Phortress\Dephenses\Taint\SanitisingFunctions;
use Phortress\Dephenses\Taint\Sinks;
use PhpParser\Node;
use PhpParser\Node\Expr\FuncCall;

class XSSVulnerabilityChecker extends VulnerabilityChecker{
	public function __construct(){
		$this->defaultMessageHeader = "XSS Injection Vulnerability was found in a call to ";
	}

	protected function containsSanitisingFunction(array $funcs){
		foreach($funcs as $func){
			if(SanitisingFunctions::isXSSSanitisingFunction($func)){
				return true;
			}
		}
		return false;
	}

	protected function isVulnerabilitySink(FuncCall $funcCall){
		return Sinks::isXSSSinkFunction($funcCall);
	}

	protected function checkSinkNodeVulnerability(Node $node, array $taints){
		if($node instanceof Node\Expr\Print_ || $node instanceof Node\Expr\Eval_ || $node
			instanceof Node\Expr\Exit_ || $node instanceof Node\Stmt\Echo_){
			$this->checkTaints($node, $taints);
		}
	}
} 