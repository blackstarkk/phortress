<?php
/**
 * Created by PhpStorm.
 * User: naomileow
 * Date: 13/11/14
 * Time: 11:05 PM
 */

namespace Phortress\Dephenses\Engine;


use PhpParser\Node\Expr\FuncCall;

class VulnerabilityReporter {
	protected  $vulnerabilityCheckers = array();
	public function __construct(){
		$this->initialiseVulnerabilityCheckers();
	}

	protected function initialiseVulnerabilityCheckers(){
		$this->vulnerabilityCheckers[] = new SQLVulnerabilityChecker();
		$this->vulnerabilityCheckers[] = new XSSVulnerabilityChecker();
		$this->vulnerabilityCheckers[] = new CodeInjectionVulnerabilityChecker();
	}

	public function runFuncCallVulnerabilityChecks(FuncCall $funcCall, $argTaints){
		foreach($this->vulnerabilityCheckers as $checker){
			$checker->checkFuncCallVulnerability($funcCall, $argTaints);
		}
	}

	public function runNodeVulnerabilityChecks(Node $node, array $taints){
		foreach($this->vulnerabilityCheckers as $checker){
			$checker->checkSinkNodeVulnerability($node, $taints);
		}
	}

	public function getVulnerabilityReport(){
		$report = array();
		foreach($this->vulnerabilityCheckers as $checker){
			$report = array_merge($report, $checker->getMessages());
		}
		return $report;
	}
} 